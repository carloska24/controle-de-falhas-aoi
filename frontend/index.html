<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>Registro de Defeitos SMD</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf-autotable.min.js"></script>
    <link rel="stylesheet" href="./style.css?v=1.5">
</head>
<body>

<div class="app-header">
    <div class="app-title">Controle de Falhas AOI</div>
    <div class="user-info">
        <span id="userDisplay"></span>
        <button id="btnLogout" class="btn outline">Sair</button>
    </div>
</div>

<div class="container main-layout">
    <div class="main-column">
        <header><div class="title">Registro de Defeitos SMD</div></header>
        
        <section class="card">
          <h2 class="section-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11 2H9C4 2 2 4 2 9V15C2 20 4 22 9 22H15C20 22 22 20 22 15V13" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M15.5 2.5L9.87 8.13C9.69 8.31 9.56 8.7 9.53 8.94L9.08 12.22C8.97 13.01 9.49 13.53 10.28 13.42L13.56 12.97C13.79 12.94 14.18 12.81 14.36 12.63L20 7C20.93 6.07 21.32 4.79 20.46 3.93C19.6 3.07 18.32 3.46 17.39 4.39" stroke="var(--primary)" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="M14.5 5.5C15.5348 6.53481 16.1652 7.96519 16.1652 9.5" stroke="var(--primary)" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/></svg>
            <span>Formul√°rio de Registro</span>
          </h2>
          <form id="formRegistro">
                <div class="grid cols-4">
                  <div class="field"><label for="om">OM (Ordem de Montagem) *</label><input id="om" name="om" required/></div>
                  <div class="field"><label for="qtdlote">Qtd de Placas do Lote *</label><input id="qtdlote" min="1" name="qtdlote" required type="number"/></div>
                  <div class="field"><label for="serial">Serial Number da Placa</label><input id="serial" name="serial"/></div>
                  <div class="field"><label for="designador">Designador *</label><input id="designador" name="designador" required/></div>
                </div>
                <div class="grid cols-4">
                  <div class="field"><label for="tipodefeito">Tipo de Defeito *</label>
                    <select id="tipodefeito" name="tipodefeito" required>
                      <option value="">‚Äî Selecione ‚Äî</option>
                      <optgroup label="Falhas Relacionadas √† Soldagem">
                        <option>Curto-circuito</option>
                        <option>Solda Fria</option>
                        <option>Excesso de Solda</option>
                        <option>Insufici√™ncia de Solda</option>
                        <option>Tombstone</option>
                        <option>Bilboard</option>
                        <option>Solder Ball</option>
                      </optgroup>
                      <optgroup label="Falhas de Posicionamento">
                        <option>Componente Ausente</option><option>Componente Danificado</option><option>Componente Deslocado</option><option>Componente Incorreto</option><option>Componente Invertido</option><option>Polaridade Incorreta</option>
                      </optgroup>
                    </select>
                  </div>
                  <div class="field"><label for="pn">Cod. Alt (C√≥digo Alternativo)</label><input id="pn" name="pn"/></div>
                  <div class="field"><label for="descricao">Descri√ß√£o do Componente</label><input id="descricao" name="descricao"/></div>
                  <div class="field"><label for="obs">Observa√ß√µes</label><textarea id="obs" name="obs"></textarea></div>
                </div>
                <div class="toolbar">
                  <div class="left">
                    <button class="btn primary" type="submit"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 19V5C3 3.89543 3.89543 3 5 3H16.1716C16.702 3 17.2107 3.21071 17.5858 3.58579L20.4142 6.41421C20.7893 6.78929 21 7.29799 21 7.82843V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8.6 9H15.4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12.4V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span class="btn-text">Gravar</span></button>
                    <button class="btn outline" id="btnLimpar" type="button"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 9L9 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>Limpar</button>
                  </div>
                  <div class="right"><span class="note">Campos com * s√£o obrigat√≥rios</span></div>
                </div>
          </form>
        </section>
        
        <section class="card">
            <h2 class="section-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 22H15C20 22 22 20 22 15V9C22 4 20 2 15 2H9C4 2 2 4 2 9V15C2 20 4 22 9 22Z" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M15.75 9H8.25" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M15.75 15H8.25" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>Registros</span>
            </h2>
            <div class="toolbar">
              <div class="left">
                <button id="btnExcluir" class="btn danger" disabled>Excluir Selecionados</button>
                <button id="btnGerarRequisicao" class="btn warn" disabled>Gerar Requisi√ß√£o</button>
                <button id="btnDemo" class="btn outline">Adicionar Demo</button>
              </div>
              <div class="right">
                <input class="search-input" id="busca" placeholder="üîé Buscar..."/>
              </div>
            </div>
      <table id="tabela">
                <thead>
                    <tr>
            <th><input class="checkbox" id="selAll" type="checkbox"/></th>
            <th class="sortable" data-key="om" aria-label="Ordenar por OM">OM</th>
            <th class="sortable" data-key="pn" aria-label="Ordenar por C√≥digo Alternativo">Cod. Alt</th>
            <th class="sortable" data-key="serial" aria-label="Ordenar por Serial">Serial</th>
            <th class="sortable" data-key="designador" aria-label="Ordenar por Designador">Designador</th>
            <th class="sortable" data-key="tipodefeito" aria-label="Ordenar por Tipo de Defeito">Defeito</th>
            <th class="sortable" data-key="descricao" aria-label="Ordenar por Descri√ß√£o">Descri√ß√£o</th>
            <th class="sortable" data-key="createdat" aria-label="Ordenar por Data/Hora">Data/Hora</th>
                    </tr>
                </thead>
                <tbody id="tbody"></tbody>
            </table>
      <div id="emptyState" class="note" style="display:none; text-align:center; margin-top:8px;">Nenhum registro encontrado.</div>
            <div class="note">Dica: Duplo clique em uma linha para editar.</div>
        </section>
    </div>

    <div class="sidebar-column">
        <section class="card noprint">
          <div class="metrics" id="metrics">
              <div class="metric"><div class="muted">Registros</div><div class="val" id="mTotal">0</div></div>
              <div class="metric"><div class="muted">OM distintas</div><div class="val" id="mOMs">0</div></div>
              <div class="metric full-width"><div class="muted">Distribui√ß√£o por Defeito (top 3)</div><div class="val" id="mDistrib">‚Äî</div></div>
          </div>
        </section>

        <section class="card" id="qualidadeCard">
            <h2 class="section-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.58984 14.62L11.3298 17.53C11.7198 18.19 12.2798 18.19 12.6698 17.53L14.4098 14.62" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 3.5V12.5" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M10.25 2H13.75" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M5.63086 7.4L7.46086 8.49" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M16.541 8.49L18.371 7.4" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 13.25H6" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M18 13.25H20" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 22C16.42 22 20 18.42 20 14C20 9.58 16.42 6 12 6C7.58 6 4 9.58 4 14C4 18.42 7.58 22 12 22Z" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>Qualidade do Lote</span>
            </h2>
            <div class="quality-wrap-vertical">
                <div class="quality-fig">
                    <canvas id="pieChart" width="220" height="220"></canvas>
                    <div class="quality-center" id="pieCenter">‚Äî</div>
                </div>
                <div class="quality-text">
                    <div class="quality-title"><span class="quality-emoji">üòê</span> <span id="qualText">Qualidade Indefinida</span></div>
                    <div class="quality-aux">Informe o <b>Total Inspecionado</b> para calcular.</div>
                    <div class="grid cols-2 quality-controls">
                        <div class="field"><label for="totalInspec">Total Inspecionado *</label><input id="totalInspec" min="0" type="number"/></div>
                        <div class="field"><label for="escopoQualidade">Escopo</label><select id="escopoQualidade"><option value="visiveis">Vis√≠veis na Tabela</option><option value="selecionados">Apenas Selecionados</option></select></div>
                    </div>
                    <div class="quality-aux" id="qualDetalhe">‚Äî</div>
                </div>
            </div>
        </section>

      <section class="card noprint">
            <h2 class="section-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.16992 14.83L14.8299 9.17" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M14.8299 14.83L9.16992 9.17" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M9 22H15C20 22 22 20 22 15V9C22 4 20 2 15 2H9C4 2 2 4 2 9V15C2 20 4 22 9 22Z" stroke="var(--primary)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>Relat√≥rios</span>
            </h2>
       <div class="grid cols-2">
        <a href="relatorio-qualidade.html" class="btn primary full-width admin-only">An√°lise de Qualidade</a>
        <a href="relatorio-qualidade.html?demo=true" class="btn warn full-width admin-only">Qualidade (c/ Demo)</a>
        <a href="almoxarifado.html" class="btn primary full-width admin-only">Almoxarifado</a>
        <a href="reparo.html" class="btn primary full-width admin-only">Tela de Reparo</a>
      </div>
        </section>
    </div>
</div>

<div id="toastContainer"></div>
<div id="loadingOverlay" class="loading-overlay hidden">
    <div class="spinner"></div>
</div>

<script src="./script.js?v=1.5"></script>
</body>
</html>